generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id        Int       @id @default(autoincrement())
  nombre    String
  email     String    @unique
  password  String
  rol       String    @default("user") // "admin", "user", "agente", etc.
  propiedades Propiedad[]
}


model Region {
  id      Int       @id @default(autoincrement())
  nombre  String    @unique
  ciudades Ciudad[]
}

model Ciudad {
  id        Int     @id @default(autoincrement())
  nombre    String
  regionId  Int
  region    Region  @relation(fields: [regionId], references: [id])
  comunas   Comuna[]
  @@unique([nombre, regionId]) // <-- ¡Esto es lo importante!
}

model Comuna {
  id        Int     @id @default(autoincrement())
  nombre    String
  ciudadId  Int
  ciudad    Ciudad  @relation(fields: [ciudadId], references: [id])
  propiedades Propiedad[]
  @@unique([nombre, ciudadId]) // <-- ¡Esto también!
}



model Propiedad {
  id           Int       @id @default(autoincrement())
  titulo       String
  precio       Float
  imagen       String
  imagenes     String[]
  descripcion  String
  status       String   // "venta" o "arriendo"
  type         String   // "departamento" | "casa" | "terreno"
  bedrooms     Int?
  bathrooms    Int?
  area         Int?
  address      String?
  lat          Float?
  lng          Float?
  comunaId     Int
  comuna       Comuna    @relation(fields: [comunaId], references: [id])
  parking      Int?
  bodega       Int?
  yearBuilt    Int?
  expenses     Int?
  publishedAt  DateTime?
  usuarioId    Int
  usuario      Usuario   @relation(fields: [usuarioId], references: [id])
  createdAt    DateTime  @default(now())
}



